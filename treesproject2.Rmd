---
title: "FlightData"
output: html_document
date: "2025-12-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}
flightdata = read.csv("C:/Users/Adam/Downloads/LAirlinedata.csv")
```

```{r}
num_cols <- names(flightdata)[sapply(flightdata, is.numeric)]
cors <- cor(flightdata[num_cols], use = "pairwise.complete.obs")
isDelayed_corrs <- cors[,"isDelayed"]
```

```{r}
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))
flightdata <- subset(flightdata, select = -DEST_STATE_ABR)
```

```{r}
library(tree)
cors <- cor(flightdata[sapply(flightdata, is.numeric)], use = "complete.obs")
tree_model <- tree(isDelayed ~ ORIGIN_AIRPORT_ID + DAY_OF_MONTH + DISTANCE + AIR_TIME,
                   data = flightdata,
                   mindev = 0.001, mincut = 1, minsize = 2)
summary(tree_model)
```

```{r}
length(unique(flightdata$MONTH))
#all months are jan, lol, this decreases model efficency
```

```{r}
library(randomForest)
library(dplyr)

flightdata <- flightdata %>%
  mutate(region = case_when(
    ORIGIN_STATE_ABR %in% c("CT","DC","DE","MA","MD","ME","NH","NJ","NY","PA","RI","VT") ~ "Northeast",
    
    ORIGIN_STATE_ABR %in% c("IA","IL","IN","MI","MN","MO","ND","NE","OH","SD","WI") ~ "Midwest",
    
    ORIGIN_STATE_ABR %in% c("AL","FL","GA","KY","MS","NC","SC","TN","VA","WV") ~ "Southeast",
    
    ORIGIN_STATE_ABR %in% c("AR","KS","LA","NM","OK","TX") ~ "South_Central",
    
    ORIGIN_STATE_ABR %in% c("AZ","CA","CO","ID","MT","NV","OR","UT","WA","WY") ~ "West",
    
    ORIGIN_STATE_ABR %in% c("AK","HI","PR","VI","GU","AS","MP","TT") ~ "Alaska_Hawaii_Territories",
    
    TRUE ~ "Other"
  )) %>%
  mutate(region = factor(region))
```

```{r}
flightdata$region <- factor(flightdata$region)
delaytime = flightdata %>%
  group_by(region) %>%
  summarise(mean_delay = mean(ARR_DELAY + DEP_DELAY, na.rm = TRUE))
```
  
  
```{r}  
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))
flightdata$ORIGIN <- factor(flightdata$ORIGIN)
flightdata$DEST <- factor(flightdata$DEST)
flightdata$ORIGIN_STATE_ABR <- factor(flightdata$ORIGIN_STATE_ABR)
flightdata$DEST_STATE_ABR <- factor(flightdata$DEST_STATE_ABR)
flightdata$region <- factor(flightdata$region)
flightdata$OP_CARRIER_AIRLINE_ID <- factor(flightdata$OP_CARRIER_AIRLINE_ID)
flightdata$CARRIER  <- as.factor(flightdata$OP_UNIQUE_CARRIER)
flightdata$DEP_HOUR <- as.factor(floor(flightdata$CRS_DEP_TIME / 100))
```

```{r}  
library(randomForest)
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))

rf_model <- randomForest(isDelayed ~ ORIGIN_AIRPORT_ID + DAY_OF_MONTH + DISTANCE + AIR_TIME + region + ORIGIN_STATE_ABR + DEST_STATE_ABR + flightdata$DEP_HOUR,
                         data = flightdata,
                         ntree = 250,       
                         mtry = 2,          
                         importance = TRUE)

print(rf_model)
```





```{r}

library(ggplot2)

ggplot(flightdata %>% group_by(region) %>% summarise(mean_delay = mean(ARR_DELAY + DEP_DELAY, na.rm = TRUE)),
       aes(region, mean_delay, fill = region)) + geom_col() + scale_fill_viridis_d()

```
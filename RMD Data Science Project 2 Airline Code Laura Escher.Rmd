---
title: "Data Science Project 2 Airline Data"
author: "Laura Escher"
date: "2025-12-04"
output: html_document
---

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
options(scientific=T, digits = 3) 
```

# Link to GitHub Repository and loading in packages
Here is a link to our repository: https://github.com/splus8191/DATS6101Group2

```{r setup and loading packages}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ezids)
library(car)
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

options(scientific=T, digits = 3)
```

Our research purpose is to determine which variables predict a late arrival for flights in the U.S. and
the degree in which they influence a late arrival. To phrase it as a question, “What are the main
determinants for a late arrival in the U.S.?” 

# EDA For the Airline Dataset

```{r}
airdata <- read.csv("C:/Users/esche_zla0rp6/OneDrive - The George Washington University/Intro to Data Science/Data Science Project 2/sample airline data.csv")

glimpse(airdata)

colSums(is.na(airdata))
sum(is.na(airdata))
```

We first opened up the file and examined the data using the str() function. We checked to see if there are any missing values in the data, which there are 2,425,691 across different columns and rows. There are 529,747 observations in this data set, and 27 variables. This data is flight specific during the month of January 2025. The variables are:

Variable  |  Definition

- YEAR | Year
- MONTH | Month (MM)
- DAY_OF_MONTH | Day of the month
- DAY_OF_WEEK | Day of the week
- OP_UNIQUE_CARRIER | Unique Carrier Code. When the same code has been used by multiple carriers, a numeric suffix is used for earlier users, for example, PA, PA(1), PA(2). Use this field for analysis across a range of years.
- ORIGIN | Origin airport
- ORIGIN_CITY_NAME | Origin Airport, City Name
- DEST | Destination Airport
- DEST_CITY_NAME | Destination Airport, City Name
- CRS_DEP_TIME | CRS Departure Time (local time: hhmm)
- DEP_TIME | Actual Departure Time (local time: hhmm)
- DEP_DELAY | Difference in minutes between scheduled and actual departure time. Early departures show negative numbers.
- DEP_DELAY_NEW | Difference in minutes between scheduled and actual departure time. Early departures set to 0.
- DEP_DEL15 | Departure Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- CRS_ARR_TIME | CRS Arrival Time (local time: hhmm)
- ARR_TIME | Actual Arrival Time (local time: hhmm)
- ARR_DELAY |	Difference in minutes between scheduled and actual arrival time. Early arrivals show negative numbers.
- ARR_DELAY_NEW | Difference in minutes between scheduled and actual arrival time. Early arrivals set to 0.
- ARR_DEL15 | Arrival Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- AIR_TIME | Flight Time, in Minutes
- DISTANCE | Distance between airports (miles)
- DISTANCE_GROUP | 
- CARRIER_DELAY | Carrier Delay, in Minutes
- WEATHER_DELAY | Weather Delay, in Minutes	
- NAS_DELAY | National Air System Delay, in Minutes	
- SECURITY_DELAY | Security Delay, in Minutes
- LATE_AIRCRAFT_DELAY | Late Aircraft Delay, in Minutes

YEAR, MONTH, DAY_OF_MONTH, DAY_OF_WEEK, OP_UNIQUE_CARRIER, airline, ORIGIN, ORIGIN_CITY_NAME, DEST, DEST_CITY_NAME, CRS_DEP_TIME, DEP_TIME, DEP_DELAY, DEP_DELAY_NEW, DEP_DEL15, DISTANCE, CRS_ARR_TIME, ARR_TIME, ARR_DELAY, ARR_DELAY_NEW, ARR_DEL15, AIR_TIME, DISTANCE, DISTANCE_GROUP, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY, delay15


Our SMART Questions for this analysis are:
- Which of the major airlines have the most reliable on-time performance for major airports?
- Is there a relationship between airport and delay frequency/type of delay?
- Is there a relationship between airline brand and delay frequency/type of delay?


First, before analyzing the data, we will match airline codes to airlines. Then, we will filter by the 9 major airlines in the U.S.: Delta, Southwest, JetBlue, United, American, Allegiant, Frontier, Hawaiian, and Alaska.
```{r}
major <- c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS')

airlinename <- data.frame(
  OP_UNIQUE_CARRIER = c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS'),
  airline = c('Delta', 'Southwest', 'JetBlue', 'United', 'American', 'Allegiant',
              'Frontier', 'Hawaiian', 'Alaska')
)
```

```{r}
data_jan <- airdata %>%
  filter(OP_UNIQUE_CARRIER %in% major) %>%
  left_join(airlinename, by = "OP_UNIQUE_CARRIER") %>%
  select(YEAR, MONTH, DAY_OF_MONTH, DAY_OF_WEEK, OP_UNIQUE_CARRIER, airline, ORIGIN, ORIGIN_CITY_NAME, DEST, DEST_CITY_NAME, CRS_DEP_TIME, DEP_TIME, DEP_DELAY, DEP_DELAY_NEW, DEP_DEL15, DISTANCE, CRS_ARR_TIME, ARR_TIME, ARR_DELAY, ARR_DELAY_NEW, ARR_DEL15, AIR_TIME, DISTANCE, DISTANCE_GROUP, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) %>%
  mutate(carrier_delay_ind = if_else(CARRIER_DELAY > 0, 1, 0),
         weather_delay_ind = if_else(WEATHER_DELAY > 0, 1, 0),
         nas_delay_ind = if_else(NAS_DELAY > 0, 1, 0),
         security_delay_ind = if_else(SECURITY_DELAY > 0, 1, 0),
         lateaircraft_delay_ind = if_else(LATE_AIRCRAFT_DELAY > 0, 1, 0)) %>%
  na.omit()

# Delay rate by airline
depdelay_summary <- data_jan %>%
  group_by(airline) %>%
  summarise(p_depdelay = mean(DEP_DEL15), n = n())
print(depdelay_summary)

# arrdelay_summary <- data_jan %>%
#   group_by(airline) %>%
#   summarise(p_arrdelay = mean(ARR_DEL15), n = n())
# print(arrdelay_summary)
```

Southwest and Allegiant have the highest departure delay rates (over 80%), meaning the majority of their flights were delayed by 15 minutes or more.

Alaska and Hawaiian have the lowest delay rates (about 70%), but still, most flights experienced delays.

The sample sizes (n) are largest for American, Delta, Southwest, and United, so their statistics are likely more stable.

All airlines in the sample have departure delay rates above 69%, which is quite high compared to typical industry averages, where usually 15-30% of flights experience significant delays.

# Convert categorical variables to factors

```{r}
data_jan$OP_UNIQUE_CARRIER <- as.factor(data_jan$OP_UNIQUE_CARRIER)
data_jan$OP_CARRIER <- as.factor(data_jan$OP_UNIQUE_CARRIER)
data_jan$DEP_DEL15 <- as.factor(data_jan$DEP_DEL15)
data_jan$MONTH <- as.factor(data_jan$MONTH)
data_jan$DAY_OF_WEEK <- as.factor(data_jan$DAY_OF_WEEK)
```

# Chi-square test: Airline vs Delay Type

```{r}
tab <- table(data_jan$airline, data_jan$DEP_DEL15)
chisq.test(tab)

This means there is a very strong statistical association between the airline and the delay status (DEP_DEL15). the likelihood that delay rates are independent of the airline is effectively zero given this p-value.

The null hypothesis (H0) states that the delay status (on-time vs delayed) is independent of the airline.
The p-value id indicate there is no significance forr that reason we reject the null hypothesis.

We can infer that the delay frequency depends o the airline.
Airlines differ statistically in their proportions of flights delayed by 15 minutes or more.

The test confirms that the asociation between airline and delay status is highly significant and no due to random chance.



chisq.test(data_jan$airline, data_jan$carrier_delay_ind)
chisq.test(data_jan$airline, data_jan$weather_delay_ind)
chisq.test(data_jan$airline, data_jan$nas_delay_ind)
chisq.test(data_jan$airline, data_jan$security_delay_ind)
chisq.test(data_jan$airline, data_jan$lateaircraft_delay_ind)
```
# Logistic regression:

```{r}
data_jan$airline <- as.factor(data_jan$airline)
data_jan$DAY_OF_WEEK <- as.factor(data_jan$DAY_OF_WEEK)

logit_model <- glm(delay15 ~ airline + DAY_OF_WEEK + CRS_DEP_TIME + DISTANCE + CARRIER_DELAY + WEATHER_DELAY + NAS_DELAY + SECURITY_DELAY + LATE_AIRCRAFT_DELAY, data = data_jan, family = binomial)
summary(logit_model)
```
```{r}
# Correlation of numeric variables
datasummary_correlation(data_jan %>% select_if(is.numeric))
```

# Boxplot: delay by airline
```{r}
ggplot(data_jan, aes(x = airline, y = DEP_DELAY)) +
  geom_boxplot() +
  labs(title = "Departure Delay by Airline (January)", x = "Airline", y = "Delay (minutes)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
data_jan %>%
  filter(airline == "Southwest") %>%
  ggplot(aes(x = DEP_DELAY)) +
  geom_histogram(binwidth = 10, color = "black", fill = "lightblue") +
  labs(
    title = "Distribution of Departure Delays for Delta (January)",
    x = "Delay (minutes)",
    y = "Count"
  ) +
  theme_bw()

```

---
title: "Data Science Project 2 Airline Data"
author: "Laura Escher"
date: "2025-12-04"
output: html_document
---

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
options(scientific=T, digits = 3) 
```

# Link to GitHub Repository and loading in packages
Here is a link to our repository: https://github.com/splus8191/DATS6101Group2

```{r setup and loading packages}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ezids)
library(car)
library(modelsummary)
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

options(scientific=T, digits = 3)
```

Our research purpose is to determine which variables predict a late arrival for flights in the U.S. and
the degree in which they influence a late arrival. To phrase it as a question, “What are the main
determinants for a late arrival in the U.S.?” 

# EDA For the Airline Dataset

```{r}
airdata <- read.csv("C:/Users/esche_zla0rp6/OneDrive - The George Washington University/Intro to Data Science/Data Science Project 2/sample airline data.csv")

glimpse(airdata)

colSums(is.na(airdata))
sum(is.na(airdata))
```

We first opened up the file and examined the data using the str() function. We checked to see if there are any missing values in the data, which there are 2,425,691 across different columns and rows. There are 529,747 observations in this data set, and 27 variables. This data is flight specific during the month of January 2025. The variables are:

Variable  |  Definition

- YEAR | Year
- MONTH | Month (MM)
- DAY_OF_MONTH | Day of the month
- DAY_OF_WEEK | Day of the week
- OP_UNIQUE_CARRIER | Unique Carrier Code. When the same code has been used by multiple carriers, a numeric suffix is used for earlier users, for example, PA, PA(1), PA(2). Use this field for analysis across a range of years.
- ORIGIN | Origin airport
- ORIGIN_CITY_NAME | Origin Airport, City Name
- DEST | Destination Airport
- DEST_CITY_NAME | Destination Airport, City Name
- CRS_DEP_TIME | CRS Departure Time (local time: hhmm)
- DEP_TIME | Actual Departure Time (local time: hhmm)
- DEP_DELAY | Difference in minutes between scheduled and actual departure time. Early departures show negative numbers.
- DEP_DELAY_NEW | Difference in minutes between scheduled and actual departure time. Early departures set to 0.
- DEP_DEL15 | Departure Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- CRS_ARR_TIME | CRS Arrival Time (local time: hhmm)
- ARR_TIME | Actual Arrival Time (local time: hhmm)
- ARR_DELAY |	Difference in minutes between scheduled and actual arrival time. Early arrivals show negative numbers.
- ARR_DELAY_NEW | Difference in minutes between scheduled and actual arrival time. Early arrivals set to 0.
- ARR_DEL15 | Arrival Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- AIR_TIME | Flight Time, in Minutes
- DISTANCE | Distance between airports (miles)
- DISTANCE_GROUP | 
- CARRIER_DELAY | Carrier Delay, in Minutes
- WEATHER_DELAY | Weather Delay, in Minutes	
- NAS_DELAY | National Air System Delay, in Minutes	
- SECURITY_DELAY | Security Delay, in Minutes
- LATE_AIRCRAFT_DELAY | Late Aircraft Delay, in Minutes

YEAR, MONTH, DAY_OF_MONTH, DAY_OF_WEEK, OP_UNIQUE_CARRIER, airline, ORIGIN, ORIGIN_CITY_NAME, DEST, DEST_CITY_NAME, CRS_DEP_TIME, DEP_TIME, DEP_DELAY, DEP_DELAY_NEW, DEP_DEL15, DISTANCE, CRS_ARR_TIME, ARR_TIME, ARR_DELAY, ARR_DELAY_NEW, ARR_DEL15, AIR_TIME, DISTANCE, DISTANCE_GROUP, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY, delay15


Our SMART Questions for this analysis are:
- Which of the major airlines have the most reliable on-time performance for airports?
- Is there a relationship between airport and delay frequency/type of delay?
- Is there a relationship between airline brand and delay frequency/type of delay?


First, before analyzing the data, we will match airline codes to airlines. Then, we will filter by the 9 major airlines in the U.S.: Delta, Southwest, JetBlue, United, American, Allegiant, Frontier, Hawaiian, and Alaska.
```{r}
major <- c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS')

airlinename <- data.frame(
  OP_UNIQUE_CARRIER = c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS'),
  airline = c('Delta', 'Southwest', 'JetBlue', 'United', 'American', 'Allegiant',
              'Frontier', 'Hawaiian', 'Alaska')
)

majorairline <- airdata %>%
  filter(OP_UNIQUE_CARRIER %in% major) %>%
  left_join(airlinename, by = "OP_UNIQUE_CARRIER") %>%  select(YEAR, MONTH, DAY_OF_MONTH, DAY_OF_WEEK, OP_UNIQUE_CARRIER, airline, ORIGIN, ORIGIN_CITY_NAME, DEST, DEST_CITY_NAME, CRS_DEP_TIME, DEP_TIME, DEP_DELAY, DEP_DELAY_NEW, DEP_DEL15, DISTANCE, CRS_ARR_TIME, ARR_TIME, ARR_DELAY, ARR_DELAY_NEW, ARR_DEL15, AIR_TIME, DISTANCE, DISTANCE_GROUP, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) %>%
  mutate(delay_minutes = (DEP_DELAY_NEW + ARR_DELAY_NEW))

majorairline <- majorairline %>%
  mutate(is_delayed = ifelse(majorairline$delay_minutes == 0, 0, 1))

delay_cols <- c("CARRIER_DELAY", "NAS_DELAY", "SECURITY_DELAY",
                "LATE_AIRCRAFT_DELAY", "WEATHER_DELAY")

majorairline[delay_cols] <- lapply(delay_cols, function(col) {
  ifelse(majorairline$delay_minutes == 0 & is.na(majorairline[[col]]),
         0,
         majorairline[[col]])
})

majorairline <- majorairline %>%
  mutate(carrier_delay_ind = if_else(CARRIER_DELAY > 0, 1, 0),
         weather_delay_ind = if_else(WEATHER_DELAY > 0, 1, 0),
         nas_delay_ind = if_else(NAS_DELAY > 0, 1, 0),
         security_delay_ind = if_else(SECURITY_DELAY > 0, 1, 0),
         lateaircraft_delay_ind = if_else(LATE_AIRCRAFT_DELAY > 0, 1, 0)) %>%
  drop_na()
```

# Delay rate by airline
```{r}
delay_summary <- majorairline %>%
  group_by(airline) %>%
  summarise(p_delay = mean(is_delayed), n = n())
print(delay_summary)

# arrdelay_summary <- data_jan %>%
#   group_by(airline) %>%
#   summarise(p_arrdelay = mean(ARR_DEL15), n = n())
# print(arrdelay_summary)
```

JetBlue and Frontier have the highest delay rates.

Southwest and Hawaiian have the lowest delay rates.

The sample sizes (n) are largest for American, Delta, Southwest, and United, so their statistics are likely more stable.

All airlines in the sample have departure delay rates above ___, which is quite high compared to typical industry averages, where usually 15-30% of flights experience significant delays.

# Convert categorical variables to factors

```{r}
majorairline$airline <- as.factor(majorairline$airline)
majorairline$OP_UNIQUE_CARRIER <- as.factor(majorairline$OP_UNIQUE_CARRIER)
majorairline$OP_CARRIER <- as.factor(majorairline$OP_UNIQUE_CARRIER)
majorairline$DEP_DEL15 <- as.factor(majorairline$DEP_DEL15)
majorairline$MONTH <- as.factor(majorairline$MONTH)
majorairline$DAY_OF_WEEK <- as.factor(majorairline$DAY_OF_WEEK)
```

# Chi-square test: Airline vs Delay Type

```{r}
tab <- table(majorairline$airline, majorairline$is_delayed)
chisq.test(tab)

chisq.test(majorairline$airline, majorairline$carrier_delay_ind)
chisq.test(majorairline$airline, majorairline$weather_delay_ind)
chisq.test(majorairline$airline, majorairline$nas_delay_ind)
chisq.test(majorairline$airline, majorairline$security_delay_ind)
chisq.test(majorairline$airline, majorairline$lateaircraft_delay_ind)

# str(data_jan)
```

# ANOVA tests delay in minutes (quantitative dependent) VS airline (factor variable)

```{r}
anova1 <- aov(delay_minutes ~ airline, data = majorairline)
summary(anova1)
TukeyHSD(anova1)
```

# Logistic regression:

```{r}
logit_model <- glm(is_delayed ~ airline + DAY_OF_WEEK + CRS_DEP_TIME + DISTANCE + CARRIER_DELAY + WEATHER_DELAY + NAS_DELAY + SECURITY_DELAY + LATE_AIRCRAFT_DELAY, data = majorairline, family = binomial)
summary(logit_model)
```

# Correlation of numeric variables
```{r}
datasummary_correlation(majorairline %>% select_if(is.numeric))
```

# Boxplot: delay by airline
```{r}
ggplot(majorairline, aes(x = airline, y = delay_minutes)) +
  geom_boxplot() +
  labs(title = "Departure Delay by Airline (January)", x = "Airline", y = "Delay (minutes)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
majorairline %>%
  filter(airline == "Delta") %>%
  ggplot(aes(x = delay_minutes)) +
  geom_histogram(binwidth = 10, color = "black", fill = "lightblue") +
  labs(
    title = "Distribution of Departure Delays for Delta (January)",
    x = "Delay (minutes)",
    y = "Count"
  ) +
  theme_bw()
```
---
title: "Data Science Project 2 Airline Data"
author: "Laura Escher, Jael Rojas, Adam Burke, Muhannad Alhamoudi"
date: "2025-12-04"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
knitr::opts_chunk$set(results="markup", warning = F, message = F)
options(scientific=T, digits = 3) 
```

# Link to GitHub Repository and loading in packages
Here is a link to our repository: https://github.com/splus8191/DATS6101Group2

```{r setup and loading packages}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ezids)
library(car)
library(modelsummary)
library(stats)
library(knitr)
library(randomForest)
library(tree)
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

options(scientific=T, digits = 3)
```

# Loading in the Dataset [Laura]

```{r}
airdata <- read.csv("C:/Users/esche_zla0rp6/OneDrive - The George Washington University/Intro to Data Science/Data Science Project 2/sample airline data.csv")
str(airdata)
colSums(is.na(airdata))
sum(is.na(airdata))
```

We first opened up the file and examined the data using the str() function. We checked to see if there are any missing values in the data, which there are 2,425,691 across different columns and rows. There are 539,747 observations in this data set, and 47 variables. This data is flight specific during the month of January 2025. We will include 27 variables from the original data set in our analysis:

Variable  |  Definition

- YEAR | Year
- MONTH | Month (MM)
- DAY_OF_MONTH | Day of the month
- DAY_OF_WEEK | Day of the week
- OP_UNIQUE_CARRIER | Unique Carrier Code. When the same code has been used by multiple carriers, a numeric suffix is used for earlier users, for example, PA, PA(1), PA(2). Use this field for analysis across a range of years.
- ORIGIN | Origin airport
- ORIGIN_CITY_NAME | Origin Airport, City Name
- DEST | Destination Airport
- DEST_CITY_NAME | Destination Airport, City Name
- CRS_DEP_TIME | CRS Departure Time (local time: hhmm)
- DEP_TIME | Actual Departure Time (local time: hhmm)
- DEP_DELAY | Difference in minutes between scheduled and actual departure time. Early departures show negative numbers.
- DEP_DELAY_NEW | Difference in minutes between scheduled and actual departure time. Early departures set to 0.
- DEP_DEL15 | Departure Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- CRS_ARR_TIME | CRS Arrival Time (local time: hhmm)
- ARR_TIME | Actual Arrival Time (local time: hhmm)
- ARR_DELAY |	Difference in minutes between scheduled and actual arrival time. Early arrivals show negative numbers.
- ARR_DELAY_NEW | Difference in minutes between scheduled and actual arrival time. Early arrivals set to 0.
- ARR_DEL15 | Arrival Delay Indicator, 15 Minutes or More (1=Yes, 0=No)
- AIR_TIME | Flight Time, in Minutes
- DISTANCE | Distance between airports (miles)
- DISTANCE_GROUP | 
- CARRIER_DELAY | Carrier Delay, in Minutes
- WEATHER_DELAY | Weather Delay, in Minutes	
- NAS_DELAY | National Air System Delay, in Minutes	
- SECURITY_DELAY | Security Delay, in Minutes
- LATE_AIRCRAFT_DELAY | Late Aircraft Delay, in Minutes

# SMART Questions

Our SMART Questions for this analysis are:
- Do certain regions have more delays?
- Is there a relationship between airline brand and delay frequency/type of delay?

# EDA [Laura]

Before filtering the data, how many airlines are there in the data set?
```{r}
airlinecode <- c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS', 'MQ', 'NK', 'PS', 'OO', 'YX', 'NA')

airlinecode1 <- data.frame(
  OP_UNIQUE_CARRIER = c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS', 'MQ', 'NK', 'PS', 'OO', 'YX', 'NA'),
  airline = c('Delta', 'Southwest', 'JetBlue', 'United', 'American', 'Allegiant',
              'Frontier', 'Hawaiian', 'Alaska', 'EnvoyAir', 'Spirit', 'PSA', 'SkyWest', 'Republic', 'NorthAmerican')
)

airdata1 <- airdata %>%
  left_join(airlinecode1, by = "OP_UNIQUE_CARRIER")

# airdata %>%
#   count(OP_UNIQUE_CARRIER)

ggplot(data = airdata1, aes(x = airline)) +
  geom_bar(fill = 'blue') +
  labs(title = "Number of Airlines",
       x = "Airlines",
       y = "Number of Flights by Airline") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.5))
```

There are 14 airlines total that flew in January 2025.

Now, before analyzing the data further, we will match airline codes to airlines. Then, we will filter by the 9 major airlines in the U.S.: Delta, Southwest, JetBlue, United, American, Allegiant, Frontier, Hawaiian, and Alaska. We also make a new variable called "delay_minutes" to sum departure and arrival delays into one column for later analysis. With delay_minutes and airline added, there are now 29 variables.

```{r}
major <- c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS')

airlinename <- data.frame(
  OP_UNIQUE_CARRIER = c('DL', 'WN', 'B6', 'UA', 'AA', 'G4', 'F9', 'HA', 'AS'),
  airline = c('Delta', 'Southwest', 'JetBlue', 'United', 'American', 'Allegiant',
              'Frontier', 'Hawaiian', 'Alaska')
)

majorairline <- airdata %>%
  filter(OP_UNIQUE_CARRIER %in% major) %>%
  left_join(airlinename, by = "OP_UNIQUE_CARRIER") %>%
  select(YEAR, MONTH, DAY_OF_MONTH, DAY_OF_WEEK, OP_UNIQUE_CARRIER, airline, ORIGIN, ORIGIN_CITY_NAME, DEST, DEST_CITY_NAME, CRS_DEP_TIME, DEP_TIME, DEP_DELAY, DEP_DELAY_NEW, DEP_DEL15, DISTANCE, CRS_ARR_TIME, ARR_TIME, ARR_DELAY, ARR_DELAY_NEW, ARR_DEL15, AIR_TIME, DISTANCE_GROUP, CARRIER_DELAY, WEATHER_DELAY, NAS_DELAY, SECURITY_DELAY, LATE_AIRCRAFT_DELAY) %>%
  mutate(delay_minutes = (DEP_DELAY_NEW + ARR_DELAY_NEW))

sum(is.na(majorairline))
colSums(is.na(majorairline))
```

Before moving forward, once again, the five types of delays all have the same number of NAs at 317,538 each. Are there any such cases where there are zeros across the five types at the same time? Maybe the Bureau of Transportation Statistics should have put zeros where they were needed. If there are structural zeros in the data set, it means that the Bureau of Transportation Statistics left out zeros in a systemic way that affects the entire data set.

```{r}
fivedelays_zero <- majorairline %>%
   filter(WEATHER_DELAY == 0,
          NAS_DELAY == 0,
          LATE_AIRCRAFT_DELAY == 0,
          CARRIER_DELAY == 0,
          SECURITY_DELAY == 0
          )
nrow(fivedelays_zero)
```
There are zero observations from the filtering the data set for cases where there are zeros across the five delay types. This confirms our suspicion of structural zeros in our data set and we can insert zeros where there should be if there were observations with zero delays.

Now, let's clean out the rest of the 1,694,386 NAs from the analysis. We will do this by routing the structural zeros to the NAs in the five types of delays when delay_minutes equals zero across those columns. This leaves us with zero NAs in our data set with 277,538 observations total. Additionally, we created indicator variables for the types of delays. We are left with 35 variables.

```{r}
majorairline <- majorairline %>%
  mutate(is_delayed = ifelse(majorairline$delay_minutes == 0, 0, 1))

delay_cols <- c("CARRIER_DELAY", "NAS_DELAY", "SECURITY_DELAY",
                "LATE_AIRCRAFT_DELAY", "WEATHER_DELAY")

majorairline[delay_cols] <- lapply(delay_cols, function(col) {
  ifelse(majorairline$delay_minutes == 0 & is.na(majorairline[[col]]),
         0,
         majorairline[[col]])
})

majorairline <- majorairline %>%
  mutate(carrier_delay_ind = if_else(CARRIER_DELAY > 0, 1, 0),
         weather_delay_ind = if_else(WEATHER_DELAY > 0, 1, 0),
         nas_delay_ind = if_else(NAS_DELAY > 0, 1, 0),
         security_delay_ind = if_else(SECURITY_DELAY > 0, 1, 0),
         lateaircraft_delay_ind = if_else(LATE_AIRCRAFT_DELAY > 0, 1, 0)) %>%
  drop_na()

sum(is.na(majorairline))
```
## Number of Flights Per Airline

```{r}
flights_per_airline <- majorairline %>%
  group_by(airline) %>%
  summarise(n_flights = n()) %>%
  arrange(desc(n_flights))

kable(flights_per_airline)

ggplot(data = majorairline, aes(x = airline)) +
  geom_bar(fill = 'blue') +
  labs(title = "Number of Flights Per Airline",
       x = "Airlines",
       y = "Number of Flights by Airline") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.5))
```

Southwest has the most amount of flights in the filtered data set, followed by Delta, American, and United.

## Delay rate by airline

Perhaps some airlines are delayed more than others. We compare airlines and their probability of being delayed below.

```{r}
delay_summary <- majorairline %>%
  group_by(airline) %>%
  summarise(p_delay = mean(is_delayed), n = n())
print(delay_summary)

ggplot(data = delay_summary, aes(x = airline, y = p_delay)) +
  geom_bar(stat = "identity", fill = 'darkseagreen') +
  labs(title = "Proportion of Delayed Flights by Airline",
       x = "Airline",
       y = "Proportion of Delays") +
  theme_minimal()
```
The highest delay rates are Frontier at 32.5% and JetBlue at 32.4%.

The lowest delay rates are Southwest at 21.3% and Hawaiian at 20.3%.

As noted in the bar chart above, the sample sizes (n) are largest for American, Delta, Southwest, and United.

All airlines in the sample have delay rates above 20% (irrespective of departure or arrival delay), which is comparable to typical industry averages, where usually 15-30% of flights experience significant delays.

There are a significant number of outliers in the data set, so we can create a box plot to illustrate if there is a difference between the airlines and their delay minutes. We also create a chart to show which airlines had the longest delays in January 2025.

```{r}
ggplot(
  data = majorairline %>% filter(delay_minutes > 0, delay_minutes <= 150),
  aes(x = airline, y = delay_minutes)
) +
  geom_boxplot() +
  labs(
    title = "Delay Minutes by Airline (Under 150 Minutes or 2.5 hour delay)",
    x = "Airline",
    y = "Delay Minutes"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


maxdelay <- majorairline %>%
  group_by(airline) %>%
  summarise(
    max_delayminutes = max(delay_minutes)
  )
print(maxdelay)

```

The box plot above shows that there are no statistically significant differences among the airlines in their total delay minutes, regardless of whether the delay was departure or arrival related. Additionally, American airlines had the longest maximum delay at 6580 minutes. The next longest delay was Allegiant at 2903 minutes in delays. The lowest delay in minutes for a single flight was from Southwest airlines at 1463 minutes.

## Delay Type Rates by Airline

```{r}
avg_delay_type <- majorairline %>%
  group_by(airline) %>%
  summarize(
    Weather = mean(weather_delay_ind),
    NAS = mean(nas_delay_ind),
    Carrier = mean(carrier_delay_ind),
    Security = mean(security_delay_ind),
    `Late Aircraft` = mean(lateaircraft_delay_ind),
    n_flights = n()
  ) %>%
    pivot_longer(
    cols = c(Weather, NAS, Carrier, Security, `Late Aircraft`),
    names_to = "delay_type",
    values_to = "rate"
  )

ggplot(avg_delay_type, aes(x = airline, y = rate, fill = delay_type)) +
  geom_col(position = "dodge") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(palette = "Set2", name = "Delay Type") +
  labs(title = "Delay Type Rates by Airline",
       x = "Airline",
       y = "Rate of Occurrence") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top")
```

JetBlue has the highest NAS and Carrier delays. Frontier has the highest late aircraft delay. Security delays were very low percentages across all the airlines, but the highest security delay rate appears to be found with Alaska airlines. Lastly, weather delays were highest with Hawaiian airlines. Overall, we were surprised that there were not higher weather delays in the data set given that it was wintertime in the U.S. and it snows at many U.S. airports during the winter season.

Let's look at the types of delays by airline and see if they differed across airlines. In general, we found that the airlines experienced delays less than 50 minutes in the following graphs.

Here are the weather delays by airline. It appears that weather delays do not differ significantly from one airline to another.
```{r}
weather_only <- majorairline %>% filter(WEATHER_DELAY > 0)

ggplot(weather_only, aes(x = airline, y = WEATHER_DELAY, fill = airline)) +
  geom_boxplot(outlier.alpha = 0.3) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 150)) +
  labs(title = "Weather Delay Duration by Airline",
       subtitle = "Flights with actual weather delays only",
       x = "Airline",
       y = "Weather Delay (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```

Here are NAS delays by airline. It appears that NAS delays do not differ significantly from one airline to another.
```{r}
nas_only <- majorairline %>% filter(NAS_DELAY > 0)

ggplot(nas_only, aes(x = airline, y = NAS_DELAY, fill = airline)) +
  geom_boxplot(outlier.alpha = 0.3) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 150)) +
  labs(title = "NAS Delay Duration by Airline",
       subtitle = "Flights with actual NAS delays only",
       x = "Airline",
       y = "NAS Delay (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```

Here are the security delays per airline. It appears that security delays do differ significantly from one airline to another.
```{r}
security_only <- majorairline %>% filter(SECURITY_DELAY > 0)

ggplot(security_only, aes(x = airline, y = SECURITY_DELAY, fill = airline)) +
  geom_boxplot(outlier.alpha = 0.3) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 150)) +
  labs(title = "Security Delay Duration by Airline",
       subtitle = "Flights with actual security delays only",
       x = "Airline",
       y = "Security Delay (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```

Here are the carrier delays per airline. It appears that carrier delays do not differ significantly from one airline to another.
```{r}
carrier_only <- majorairline %>% filter(CARRIER_DELAY > 0)

ggplot(carrier_only, aes(x = airline, y = CARRIER_DELAY, fill = airline)) +
  geom_boxplot(outlier.alpha = 0.3) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 150)) +
  labs(title = "Carrier Delay Duration by Airline",
       subtitle = "Flights with actual carrier delays only",
       x = "Airline",
       y = "Carrier Delay (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```

Here are the late aircraft delays per airline. It appears that late aircraft delays do not differ significantly from one airline to another.
```{r}
lateaircraft_only <- majorairline %>% filter(LATE_AIRCRAFT_DELAY > 0)

ggplot(lateaircraft_only, aes(x = airline, y = LATE_AIRCRAFT_DELAY, fill = airline)) +
  geom_boxplot(outlier.alpha = 0.3) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 150)) +
  labs(title = "Late Aircraft Delay Duration by Airline",
       subtitle = "Flights with actual late aircraft delays only",
       x = "Airline",
       y = "Aircraft Delay (minutes)") +
  theme_minimal() +
  theme(legend.position = "none")
```

## EDA for Origin Airport and Destination Airport Delay Probabilities

For the last portion of EDA, we thought it would be a good idea to showcase the delays by origin and destination airport.

```{r}
originairport_summary <- majorairline %>%
  group_by(ORIGIN_CITY_NAME) %>%
  summarize(
    delay_rate = mean(is_delayed),
    n_flights = n()
  ) %>%
  filter(n_flights >= 100)

worst_25 <- originairport_summary %>%
  arrange(desc(delay_rate)) %>%
  head(25)

ggplot(worst_25, aes(x = reorder(ORIGIN_CITY_NAME, delay_rate), y = delay_rate)) +
  geom_col(fill = "coral", alpha = 0.8) +
  geom_text(aes(label = paste0(round(delay_rate * 100, 1), "%")), 
            hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = scales::percent, 
                     limits = c(0, max(worst_25$delay_rate) * 1.1)) +
  labs(title = "Top 25 Origin Airports with Highest Delay Rates",
       subtitle = "Airports with 100+ flights only",
       x = "Origin Airport", 
       y = "Proportion of Delayed Flights") +
  theme_minimal()
```



```{r}
destairport_summary <- majorairline %>%
  group_by(DEST_CITY_NAME) %>%
  summarize(
    delay_rate = mean(is_delayed),
    n_flights = n()
  ) %>%
  filter(n_flights >= 100)

destworst_25 <- destairport_summary %>%
  arrange(desc(delay_rate)) %>%
  head(25)

ggplot(destworst_25, aes(x = reorder(DEST_CITY_NAME, delay_rate), y = delay_rate)) +
  geom_col(fill = "cadetblue3", alpha = 0.8) +
  geom_text(aes(label = paste0(round(delay_rate * 100, 1), "%")), 
            hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = scales::percent, 
                     limits = c(0, max(destworst_25$delay_rate) * 1.1)) +
  labs(title = "Top 25 Destination Airports with Highest Delay Rates",
       subtitle = "Airports with 100+ flights only",
       x = "Destination Airport", 
       y = "Proportion of Delayed Flights") +
  theme_minimal()
```

## Convert categorical variables to factors

Before finishing up EDA, we decided to convert certain variables to factor variables.

```{r}
majorairline$airline <- as.factor(majorairline$airline)
majorairline$OP_UNIQUE_CARRIER <- as.factor(majorairline$OP_UNIQUE_CARRIER)
majorairline$OP_CARRIER <- as.factor(majorairline$OP_UNIQUE_CARRIER)
majorairline$DEP_DEL15 <- as.factor(majorairline$DEP_DEL15)
majorairline$MONTH <- as.factor(majorairline$MONTH)
majorairline$DAY_OF_WEEK <- as.factor(majorairline$DAY_OF_WEEK)
majorairline$DEST <- as.factor(majorairline$DEST)
majorairline$ORIGIN <- as.factor(majorairline$ORIGIN)
```

# Statistical Tests [Muhannad]

## Chi-square test: Airline vs Delay Type

```{r}
tab <- table(majorairline$airline, majorairline$is_delayed)
chisq.test(tab)
```

There is a significant relationship between airline and delay frequency.
Some airlines have a much higher proportion of delayed flights than others.

## Chi-square Tests: Airline vs Type of Delay
```{r}
chisq.test(majorairline$airline, majorairline$carrier_delay_ind)
chisq.test(majorairline$airline, majorairline$weather_delay_ind)
chisq.test(majorairline$airline, majorairline$nas_delay_ind)
chisq.test(majorairline$airline, majorairline$security_delay_ind)
chisq.test(majorairline$airline, majorairline$lateaircraft_delay_ind)
```

There is a significant relationship between airline and each type of delay.
Different airlines experience weather, carrier, NAS, security, and late-aircraft delays at different rates, meaning some airlines are more prone to certain delay types than others.

Based on Chi-Square tests (p < 2e-16 for all comparisons), there is a strong and statistically significant relationship between airline brand and both delay frequency and delay type. This indicates that delays are not evenly distributed across airlines; instead, some airlines are more prone to specific kinds of delays than others.

## ANOVA tests delay in minutes (quantitative dependent) VS airline (factor variable)

```{r}
anova1 <- aov(delay_minutes ~ airline, data = majorairline)
summary(anova1)
TukeyHSD(anova1)
```

There are significant differences in the average delay minutes across airlines (p < 2eâˆ’16).
Some airlines have much longer delays than others.

# Decision Tree [Adam]

We read the data in.
```{r}
flightdata = read.csv("C:/Users/Adam/Desktop/Binary_Flight_data/LAirlinedata.csv")
```

It is important to look at numerical value correlations with the target.This wont capture factor variable correlation but will show us the continuous numerical value correlation. This will give us a picture of what our decision tree will use.

```{r}
num_cols <- names(flightdata)[sapply(flightdata, is.numeric)]
cors <- cor(flightdata[num_cols], use = "pairwise.complete.obs")
isDelayed_corrs <- cors[,"isDelayed"]
```

convert the target to a factor variable and create the hour variable to help with training.

```{r}
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))
flightdata <- subset(flightdata, select = -DEST_STATE_ABR)
```


```{r}
flightdata <- flightdata %>%
  mutate(region = case_when(
    ORIGIN_STATE_ABR %in% c("CT","DC","DE","MA","MD","ME","NH","NJ","NY","PA","RI","VT") ~ "Northeast",
    
    ORIGIN_STATE_ABR %in% c("IA","IL","IN","MI","MN","MO","ND","NE","OH","SD","WI") ~ "Midwest",
    
    ORIGIN_STATE_ABR %in% c("AL","FL","GA","KY","MS","NC","SC","TN","VA","WV") ~ "Southeast",
    
    ORIGIN_STATE_ABR %in% c("AR","KS","LA","NM","OK","TX") ~ "South_Central",
    
    ORIGIN_STATE_ABR %in% c("AZ","CA","CO","ID","MT","NV","OR","UT","WA","WY") ~ "West",
    
    ORIGIN_STATE_ABR %in% c("AK","HI","PR","VI","GU","AS","MP","TT") ~ "Alaska_Hawaii_Territories",
    
    TRUE ~ "Other"
  )) %>%
  mutate(region = factor(region))
```

```{r}
flightdata$region <- factor(flightdata$region)
delaytime = flightdata %>%
  group_by(region) %>%
  summarise(mean_delay = mean(ARR_DELAY + DEP_DELAY, na.rm = TRUE))
```
  
```{r}  
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))
flightdata$ORIGIN <- factor(flightdata$ORIGIN)
flightdata$DEST <- factor(flightdata$DEST)
flightdata$ORIGIN_STATE_ABR <- factor(flightdata$ORIGIN_STATE_ABR)
flightdata$region <- factor(flightdata$region)
flightdata$OP_CARRIER_AIRLINE_ID <- factor(flightdata$OP_CARRIER_AIRLINE_ID)
flightdata$CARRIER  <- as.factor(flightdata$OP_UNIQUE_CARRIER)
flightdata$DEP_HOUR <- as.factor(floor(flightdata$CRS_DEP_TIME / 100))
```

This is how we train the singular decision tree. This sadly was not able to capture the factor variables due to the how many levels were in them. Our factor variables such as states had more than the max of 32.ORIGIN_AIRPORT_ID was left in there to display how a non factorized factor variable will just get unused in training. This has moderate accuracy.    

```{r}
tree_model <- tree(
  isDelayed ~ ORIGIN_AIRPORT_ID + DAY_OF_MONTH + DISTANCE + AIR_TIME + DEP_HOUR,
  data = flightdata,
  mindev = 0.001, mincut = 1, minsize = 4
)

summary(tree_model)
```

All months are in January, this decreases model accuracy. 
```{r}
length(unique(flightdata$MONTH))
```


```{r}
flightdata$isDelayed <- factor(flightdata$isDelayed, levels = c(0,1))

rf_model <- randomForest(isDelayed ~ ORIGIN_AIRPORT_ID + DAY_OF_MONTH + OP_UNIQUE_CARRIER + DISTANCE + AIR_TIME + region + ORIGIN_STATE_ABR + DEST_STATE_ABR + flightdata$DEP_HOUR,
                         data = flightdata,
                         ntree = 500,       
                         mtry = 2,          
                         importance = TRUE)

print(rf_model)
```

This is the plot of the different regions average DEP_DELAY. This will show patterns in the data for which regions have the worst delays. Arrival delays are less important because they can be a result of the departure delay. We can see in this graph which regions are most on time. This is important when consulting the infrastructure. When it does come to arrival delays though, much time is made up when en route to west coast states.

```{r}
ggplot(flightdata %>% 
         group_by(region) %>% 
         summarise(mean_delay = mean(DEP_DELAY, na.rm = TRUE)),
       aes(x = region, y = mean_delay, color = region)) +
  geom_point(size = 4) +
  scale_color_viridis_d() +
  labs(title = "Mean Departure Delay by Region",
       y = "Mean Delay (minutes)", x = "Region")

ggplot(flightdata %>% group_by(region) %>% summarise(mean_delay = mean(DEP_DELAY, na.rm = TRUE)),
       aes(region, mean_delay, fill = region)) + geom_col() + scale_fill_viridis_d()

ggplot(flightdata %>% 
         group_by(region) %>% 
         summarise(mean_delay = mean(ARR_DELAY, na.rm = TRUE)),
       aes(x = region, y = mean_delay, color = region)) +
  geom_point(size = 4) +
  scale_color_viridis_d() +
  labs(title = "Mean Departure Arrival by Region",
       y = "Mean Delay (minutes)", x = "Region")
```

To see that there is an actual statistical significance within the data we need to run a chi squared test. Based off the data we can see the results show that there is a difference and the region does make a difference.

```{r}
cont_table <- table(flightdata$isDelayed, flightdata$region)

print(cont_table)

addmargins(cont_table)

chi_result <- chisq.test(cont_table)

chi_result
```

# Logistic Regression and Next Month Delay Prediction [Jael]